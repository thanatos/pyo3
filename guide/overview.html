<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Overview - PyO3 user guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme;
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            document.querySelector('html').classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="overview.html" class="active">Overview</a></li><li class="affix"><a href="getting_started.html">Getting Started</a></li><li><a href="conversions.html"><strong aria-hidden="true">1.</strong> Type Conversions</a></li><li><a href="exception.html"><strong aria-hidden="true">2.</strong> Python Exception</a></li><li><a href="module.html"><strong aria-hidden="true">3.</strong> Python Module</a></li><li><a href="function.html"><strong aria-hidden="true">4.</strong> Python Function</a></li><li><a href="class.html"><strong aria-hidden="true">5.</strong> Python Class</a></li><li><a href="parallelism.html"><strong aria-hidden="true">6.</strong> Parallelism</a></li><li><a href="distribution.html"><strong aria-hidden="true">7.</strong> Distribution</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                        </div>

                        <h1 class="menu-title">PyO3 user guide</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="overview.html#overview" id="overview"><h1>Overview</h1></a>
<p><a href="https://travis-ci.org/PyO3/pyo3"><img src="https://travis-ci.org/PyO3/pyo3.svg?branch=master" alt="Build Status" /></a>
<a href="https://crates.io/crates/pyo3"><img src="https://img.shields.io/crates/v/pyo3.svg" alt="Latest Version" /></a>
<a href="http://pyo3.github.io/pyo3/pyo3/"><img src="https://img.shields.io/badge/api-rustdoc-blue.svg" alt="Rust Documentation" /></a></p>
<p>PyO3 is a <a href="http://www.rust-lang.org/">Rust</a> bindings for the <a href="https://www.python.org/">Python</a> interpreter.</p>
<p>Supported Python versions:</p>
<ul>
<li>Python2.7, Python 3.5 and up</li>
</ul>
<p>Supported Rust version:</p>
<ul>
<li>Rust 1.20.0-nightly or later</li>
<li>On Windows, we require rustc 1.20.0-nightly</li>
</ul>
<a class="header" href="overview.html#usage" id="usage"><h2>Usage</h2></a>
<p>To use <code>pyo3</code>, add this to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
pyo3 = &quot;0.2&quot;
</code></pre>
<p>Example program displaying the value of <code>sys.version</code>:</p>
<pre><pre class="playpen"><code class="language-rust">extern crate pyo3;

use pyo3::{Python, PyDict, PyResult};

fn main() {
    let gil = Python::acquire_gil();
    hello(gil.python()).unwrap();
}

fn hello(py: Python) -&gt; PyResult&lt;()&gt; {
    let sys = py.import(&quot;sys&quot;)?;
    let version: String = sys.get(&quot;version&quot;)?.extract()?;

    let locals = PyDict::new(py);
    locals.set_item(&quot;os&quot;, py.import(&quot;os&quot;)?)?;
    let user: String = py.eval(&quot;os.getenv('USER') or os.getenv('USERNAME')&quot;, None, Some(&amp;locals))?.extract()?;

    println!(&quot;Hello {}, I'm Python {}&quot;, user, version);
    Ok(())
}
</code></pre></pre>
<p>Example library with python bindings:</p>
<p>The following two files will build with <code>cargo build</code>, and will generate a python-compatible library.
For MacOS, &quot;-C link-arg=-undefined -C link-arg=dynamic_lookup&quot; is required to build the library.
<code>setuptools-rust</code>includes this by default.
See <a href="https://github.com/PyO3/pyo3/tree/master/examples/word-count">examples/word-count</a>.
Also on macOS, you will need to rename the output from *.dylib to *.so.
On Windows, you will need to rename the output from *.dll to *.pyd.</p>
<p><strong><code>Cargo.toml</code>:</strong></p>
<pre><code class="language-toml">[lib]
name = &quot;rust2py&quot;
crate-type = [&quot;cdylib&quot;]

[dependencies.pyo3]
version = &quot;0.2&quot;
features = [&quot;extension-module&quot;]
</code></pre>
<p><strong><code>src/lib.rs</code></strong></p>
<pre><pre class="playpen"><code class="language-rust">#![feature(proc_macro, specialization)]

extern crate pyo3;
use pyo3::{py, PyResult, Python, PyModule};

// add bindings to the generated python module
// N.B: names: &quot;librust2py&quot; must be the name of the `.so` or `.pyd` file
/// This module is implemented in Rust.
#[py::modinit(rust2py)]
fn init_mod(py: Python, m: &amp;PyModule) -&gt; PyResult&lt;()&gt; {

    #[pyfn(m, &quot;sum_as_string&quot;)]
    // pyo3 aware function. All of our python interface could be declared in a separate module.
    // Note that the `#[pyfn()]` annotation automatically converts the arguments from
    // Python objects to Rust values; and the Rust return value back into a Python object.
    fn sum_as_string_py(_: Python, a:i64, b:i64) -&gt; PyResult&lt;String&gt; {
       let out = sum_as_string(a, b);
       Ok(out)
    }

    Ok(())
}

// logic implemented as a normal rust function
fn sum_as_string(a:i64, b:i64) -&gt; String {
    format!(&quot;{}&quot;, a + b).to_string()
}

# fn main() {}
</code></pre></pre>
<p>For <code>setup.py</code> integration, see <a href="https://github.com/PyO3/setuptools-rust">setuptools-rust</a></p>
<a class="header" href="overview.html#ownership-and-lifetimes" id="ownership-and-lifetimes"><h2>Ownership and Lifetimes</h2></a>
<p>In Python, all objects are implicitly reference counted.
In Rust, we will use the <a href="https://pyo3.github.io/pyo3/pyo3/struct.PyObject.html"><code>PyObject</code></a> type
to represent a reference to a Python object.</p>
<p>Because all Python objects potentially have multiple owners, the
concept of Rust mutability does not apply to Python objects.
As a result, this API will <strong>allow mutating Python objects even if they are not stored
in a mutable Rust variable</strong>.</p>
<p>The Python interpreter uses a global interpreter lock (GIL) to ensure thread-safety.
This API uses a zero-sized <a href="https://pyo3.github.io/pyo3/pyo3/struct.Python.html"><code>struct Python&lt;'p&gt;</code></a> as a token to indicate
that a function can assume that the GIL is held.</p>
<p>You obtain a <a href="https://pyo3.github.io/pyo3/pyo3/struct.Python.html"><code>Python</code></a> instance
by acquiring the GIL, and have to pass it into some operations that call into the Python runtime.</p>
<p>PyO3 library provides wrappers for python native objects. Ownership of python objects are
disallowed because any access to python runtime has to be protected by GIL.
All apis are available through references. Lifetimes of python object's references are
bound to GIL lifetime.</p>
<p>There are two types of pointers that could be stored on rust structs.
Both implements <code>Send</code> and <code>Sync</code> traits and maintain python object's reference count.</p>
<ul>
<li>
<p><a href="https://pyo3.github.io/pyo3/pyo3/struct.PyObject.html"><code>PyObject</code></a> is general purpose
type. It does not maintain type of the referenced object. It provides helper methods
for extracing rust values and casting to specific python object type.</p>
</li>
<li>
<p><a href="https://pyo3.github.io/pyo3/pyo3/struct.Py.html"><code>Py&lt;T&gt;</code></a> represents a reference to a
concrete python object <code>T</code>.</p>
</li>
</ul>
<p>To upgrade to a reference <a href="https://pyo3.github.io/pyo3/pyo3/trait.AsPyRef.html"><code>AsPyRef</code></a>
trait can be used.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        
                            <a rel="next" href="getting_started.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
                    <a href="getting_started.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if (getComputedStyle(document.querySelector(".fa")).fontFamily !== "FontAwesome") {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '_FontAwesome/css/font-awesome.css';
                document.head.insertBefore(link, document.head.firstChild)
            }
        </script>

        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
